<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <style>
    body{
      font-family:'PingFang SC','Segoe UI',sans-serif;
      background: linear-gradient(135deg,#f9f9f9,#eaf1ff);
      color:#333;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      padding:1rem;
      box-sizing:border-box;
    }
    h1{font-size:1.8rem;color:#5a7cff;margin-bottom:1rem}
    .envelope{
      width:260px;height:160px;background:#fff;border:2px solid #c7d2fe;border-radius:8px;
      box-shadow:0 6px 12px rgba(90,124,255,0.12);transition:transform .6s;cursor:pointer;margin-bottom:1rem;
    }
    .envelope.open{ transform: rotateX(180deg); }
    textarea{
      width:90%;height:120px;font-size:1rem;padding:1rem;border-radius:10px;border:1px solid #ccc;
      outline:none;resize:none;margin-bottom:.8rem;
    }
    button{
      padding:.6rem 1.2rem;border:none;border-radius:8px;background:#5a7cff;color:#fff;cursor:pointer;font-size:1rem;
    }
    button:hover{background:#4668e8}
    #loading{margin-top:.8rem;color:#666;display:none}
    #output{
      margin-top:1rem;white-space:pre-wrap;width:90%;padding:1rem;background:#fff;border-radius:10px;border:1px solid #eee;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);min-height:60px;display:none;
    }
    .controls{margin-top:.6rem;display:flex;gap:.5rem}
    .controls button{background:#6fc3a6}
  </style>
</head>
<body>
  <h1>æœªæ¥å›éŸ³ ğŸ’Œ</h1>
  <div class="envelope" id="envelope" title="ç‚¹å‡»å±•å¼€ä¿¡å°"></div>

  <textarea id="userInput" placeholder="å†™ä¸‹æ­¤åˆ»çš„å¿ƒå£°ã€ç–‘æƒ‘æˆ–æ„¿æœ›..."></textarea>
  <div>
    <button id="sendBtn">âœ¨ ç”Ÿæˆæœªæ¥å›ä¿¡</button>
  </div>

  <div id="loading">ğŸ¤– æ­£åœ¨ç”Ÿæˆæœªæ¥çš„å›éŸ³...</div>
  <div id="output"></div>

  <script>
    (function(){
      const envelope = document.getElementById('envelope');
      const sendBtn = document.getElementById('sendBtn');
      const inputEl = document.getElementById('userInput');
      const loadingEl = document.getElementById('loading');
      const outputEl = document.getElementById('output');

      loadingEl.style.display = 'none';

      envelope.addEventListener('click', () => {
        envelope.classList.toggle('open');
      });

      sendBtn.addEventListener('click', async () => {
        const input = inputEl.value.trim();
        if(!input) { alert('è¯·è¾“å…¥å†…å®¹'); return; }

        loadingEl.style.display = 'block';
        outputEl.style.display = 'none';
        outputEl.innerText = '';

        try {
          const res = await fetch('/api/generate', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ input })
          });

          loadingEl.style.display = 'none';

          if (!res.ok) {
            const errText = await res.text().catch(()=>null);
            outputEl.innerText = 'è¯·æ±‚å¤±è´¥: ' + (errText || res.statusText || res.status);
            outputEl.style.display = 'block';
            return;
          }

          const data = await res.json().catch(()=>null);
          if (data && data.reply) {
            outputEl.innerText = data.reply;
            outputEl.style.display = 'block';
            envelope.classList.add('open');
          } else {
            outputEl.innerText = 'æœªæ¥æš‚æ—¶æ²¡æ¥å¾—åŠå›å¤ã€‚';
            outputEl.style.display = 'block';
          }
        } catch (err) {
          loadingEl.style.display = 'none';
          outputEl.innerText = 'ç½‘ç»œæˆ–æœåŠ¡å™¨é”™è¯¯: ' + (err && err.message ? err.message : String(err));
          outputEl.style.display = 'block';
        }
      });
    })();
  </script>
</body>
</html>
