<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="envelope" id="envelope"></div>
  <div class="title">æœªæ¥å›éŸ³ ğŸ’Œ</div>

  <div class="input-area" id="inputArea">
    <textarea id="message" placeholder="å†™ä¸‹æ­¤åˆ»å¿ƒå£°..."></textarea>
    <div>
      <label><input type="radio" name="voice" value="female" checked> å¥³å£°</label>
      <label><input type="radio" name="voice" value="male"> ç”·å£°</label>
    </div>
    <button id="generate">ç”Ÿæˆæœªæ¥å›ä¿¡</button>
  </div>

  <div class="letter" id="letter"></div>
  <div class="controls" id="controls" style="display:none;">
    <button id="voiceBtn">ğŸ”Š æ’­æ”¾è¯­éŸ³</button>
  </div>

  <script>
    const envelope = document.getElementById("envelope");
    const inputArea = document.getElementById("inputArea");
    const letter = document.getElementById("letter");
    const controls = document.getElementById("controls");
    const voiceBtn = document.getElementById("voiceBtn");
    const generateBtn = document.getElementById("generate");
    const body = document.body;

    const gradients = [
      ["#ff9edb", "#cdb0ff"],
      ["#ffc4a4", "#ff8db0"],
      ["#a4bfff", "#c6a4ff"],
      ["#ffa8b0", "#ffb0f0"]
    ];

    // 3ç§’åè‡ªåŠ¨è¿›å…¥è¾“å…¥ç•Œé¢
    setTimeout(() => showInput(), 3000);
    envelope.addEventListener("click", showInput);

    function showInput() {
      envelope.style.opacity = "0";
      setTimeout(() => {
        envelope.style.display = "none";
        inputArea.style.display = "flex";
      }, 1000);
    }

    // ç‚¹å‡»ç”Ÿæˆæœªæ¥å›ä¿¡
    generateBtn.addEventListener("click", async () => {
      const text = document.getElementById("message").value.trim();
      const gender = document.querySelector('input[name="voice"]:checked').value;

      if (!text) return alert("è¯·å…ˆå†™ä¸‹ä½ çš„å¿ƒå£° âœ¨");

      inputArea.style.display = "none";
      letter.style.display = "flex";
      letter.innerHTML = `<p>æœªæ¥çš„ä½ è¯´ï¼š</p ><p>${text}</p >`;
      controls.style.display = "flex";

      // æµè§ˆå™¨è¯­éŸ³
      let utter = new SpeechSynthesisUtterance(text);
      utter.lang = "zh-CN";
      utter.pitch = gender === "male" ? 0.9 : 1.1;
      utter.rate = 1;

      let voices = [];
      function loadVoices() {
        voices = speechSynthesis.getVoices();
        utter.voice = voices.find(v =>
          gender === "male" ? v.name.includes("ç”·") : v.name.includes("å¥³")
        ) || voices[0];
      }
      loadVoices();
      speechSynthesis.onvoiceschanged = loadVoices;

      let playing = false;
      voiceBtn.onclick = () => {
        if (!playing) {
          speechSynthesis.speak(utter);
          playing = true;
          voiceBtn.textContent = "â¹ åœæ­¢æ’­æ”¾";
        } else {
          speechSynthesis.cancel();
          playing = false;
          voiceBtn.textContent = "ğŸ”Š æ’­æ”¾è¯­éŸ³";
        }
      };
    });

    // ç‚¹å‡»èƒŒæ™¯åˆ‡æ¢æ¸å˜è‰²
    body.addEventListener("click", () => {
      const g = gradients[Math.floor(Math.random() * gradients.length)];
      body.style.background = `radial-gradient(circle at center, ${g[0]}, ${g[1]}, #000)`;
    });
  </script>
</body>
</html>
